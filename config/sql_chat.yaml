# SQL Chat (Chat with Data) Configuration
# Text-to-SQL natural language query interface

# Connection settings
connections:
  # Maximum connections per user
  max_per_user: 10

  # Supported database types
  supported_types:
    - postgresql
    - mysql
    - sqlite

  # Default ports for each database type
  default_ports:
    postgresql: 5432
    mysql: 3306
    sqlite: 0

  # Connection pool settings
  pool:
    size: 5
    max_overflow: 10
    timeout_seconds: 30

  # Password encryption (set SQL_CHAT_ENCRYPTION_KEY env var for persistence)
  # If not set, passwords are encrypted with session-only key
  password_encryption_key_env: "SQL_CHAT_ENCRYPTION_KEY"

# Query execution settings
query:
  # Maximum rows to return
  max_rows: 10000

  # Query timeout in seconds
  timeout_seconds: 30

  # Maximum correction attempts for syntax errors
  max_correction_attempts: 3

  # Maximum semantic inspection retries
  max_semantic_retries: 3

  # Cost estimation thresholds
  cost_estimation:
    max_estimated_rows: 100000
    max_cost_units: 50000

# Schema introspection settings
schema:
  # Schema cache TTL in seconds (1 hour default)
  cache_ttl_seconds: 3600

  # Maximum sample values to extract per column
  max_sample_values: 5

  # Table count threshold for retriever-based engine
  table_threshold: 20

# Few-shot learning settings
few_shot:
  # Dataset name on HuggingFace
  dataset_name: "gretelai/synthetic_text_to_sql"

  # Number of examples to retrieve for few-shot prompting
  top_k: 5

  # Batch size for embedding during setup
  batch_size: 100

  # Minimum examples required for setup to be considered complete
  min_required_examples: 50000

  # RAG integration for enhanced retrieval
  # Uses hybrid BM25+vector search with optional reranking
  rag_integration:
    # Enable hybrid search (BM25 + vector)
    enabled: true

    # Use reranker for final ranking
    use_reranker: true

    # Reranker model (cross-encoder) - using larger model for better accuracy
    rerank_model: "mixedbread-ai/mxbai-rerank-large-v1"

    # Number of candidates to retrieve before reranking
    rerank_top_k: 15

    # Hybrid search weights (must sum to 1.0)
    weights:
      bm25: 0.3
      vector: 0.7

# Intent classification settings
intent:
  # Default intent when detection confidence is low
  default_intent: "lookup"

  # Confidence thresholds
  confidence_thresholds:
    high: 0.3
    medium: 0.2
    low: 0.1

# Confidence scoring settings
confidence:
  # Score thresholds for confidence levels
  thresholds:
    high: 0.8
    medium: 0.5

  # Weights for confidence factors
  weights:
    table_relevance: 0.30
    few_shot_similarity: 0.30
    retry_penalty: 0.20
    column_overlap: 0.20

# Security settings
security:
  # Operations that are never allowed in generated SQL
  forbidden_operations:
    - DROP
    - DELETE
    - TRUNCATE
    - ALTER
    - INSERT
    - UPDATE
    - CREATE
    - GRANT
    - REVOKE
    - EXEC
    - EXECUTE

  # Require read-only database user
  require_read_only_user: true

  # Enable SQL injection pattern detection
  detect_injection_patterns: true

# Data masking defaults
masking:
  # Auto-detect sensitive columns by name patterns
  auto_detect: true

  # Patterns for auto-detection (columns to mask)
  sensitive_patterns:
    mask:
      - email
      - phone
      - address
      - dob
      - date_of_birth

    redact:
      - password
      - secret
      - token
      - api_key
      - ssn
      - social_security

    hash:
      - user_id
      - customer_id
      - account_id

# Telemetry settings
telemetry:
  # Enable query telemetry logging
  enabled: true

  # Maximum in-memory entries (before DB persistence)
  max_memory_entries: 1000

  # Days of telemetry to retain
  retention_days: 90

# Session settings
session:
  # Maximum exchanges in conversation memory
  max_history: 10

  # Session idle timeout (minutes)
  idle_timeout_minutes: 30
